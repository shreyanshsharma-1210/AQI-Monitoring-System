<div align="center">

<img src="https://capsule-render.vercel.app/api?type=waving&color=0:0f0c29,50:302b63,100:24243e&height=280&section=header&text=AQIfy&fontSize=120&fontAlignY=38&animation=fadeIn&fontColor=ffffff&desc=Real-Time%20AQI%20Intelligence%20Engine%20%E2%80%94%20Powered%20by%20Pathway&descAlignY=62&descSize=22&descColor=a5b4fc" />

<br/>

<p align="center">
  <a href="#"><img src="https://img.shields.io/badge/version-3.4.0-6366F1?style=for-the-badge&logo=semver&logoColor=white" /></a>
  <a href="#"><img src="https://img.shields.io/badge/build-passing-10B981?style=for-the-badge&logo=github-actions&logoColor=white" /></a>
  <a href="#"><img src="https://img.shields.io/badge/license-MIT-F59E0B?style=for-the-badge&logo=open-source-initiative&logoColor=white" /></a>
  <a href="#"><img src="https://img.shields.io/badge/cities-45%2B-EF4444?style=for-the-badge&logo=googlemaps&logoColor=white" /></a>
  <a href="#"><img src="https://img.shields.io/badge/latency-%3C1s-3B82F6?style=for-the-badge&logo=lightning&logoColor=white" /></a>
  <a href="#"><img src="https://img.shields.io/badge/stars-â­_give_one!-FBBF24?style=for-the-badge" /></a>
</p>

<p align="center">
  <img src="https://img.shields.io/badge/Pathway-0.27.0-6366F1?style=flat-square&logo=python&logoColor=white" />
  <img src="https://img.shields.io/badge/React-18-61DAFB?style=flat-square&logo=react&logoColor=black" />
  <img src="https://img.shields.io/badge/FastAPI-009688?style=flat-square&logo=fastapi&logoColor=white" />
  <img src="https://img.shields.io/badge/PostgreSQL-15-316192?style=flat-square&logo=postgresql&logoColor=white" />
  <img src="https://img.shields.io/badge/Redis-7-DC382D?style=flat-square&logo=redis&logoColor=white" />
  <img src="https://img.shields.io/badge/Docker-2496ED?style=flat-square&logo=docker&logoColor=white" />
  <img src="https://img.shields.io/badge/TypeScript-3178C6?style=flat-square&logo=typescript&logoColor=white" />
  <img src="https://img.shields.io/badge/Socket.IO-000000?style=flat-square&logo=socket.io&logoColor=white" />
</p>

<br/>

<p align="center">
  <a href="#-the-problem"><b>Problem</b></a> â€¢
  <a href="#-solution"><b>Solution</b></a> â€¢
  <a href="#-features"><b>Features</b></a> â€¢
  <a href="#%EF%B8%8F-architecture"><b>Architecture</b></a> â€¢
  <a href="#-tech-stack"><b>Tech Stack</b></a> â€¢
  <a href="#-quick-start"><b>Quick Start</b></a> â€¢
  <a href="#-api-reference"><b>API</b></a> â€¢
  <a href="#-gamification"><b>Gamification</b></a> â€¢
  <a href="#%EF%B8%8F-roadmap"><b>Roadmap</b></a>
</p>

<br/>

> **ğŸŒ«ï¸ Live air quality data. Personalised health insights. Gamified engagement.**
> *A real-time, personalised, gamified AQI intelligence platform built on Pathway's stream processing engine â€” delivering live air quality insights that are actually actionable.*

</div>

<br/>

<img src="https://capsule-render.vercel.app/api?type=rect&color=gradient&customColorList=0,2,4&height=3&section=header" />

<br/>

## ğŸŒ The Problem

<table>
<tr>
<td width="58%">

### Air Quality â€” A Silent Crisis

Millions of Indians make daily decisions â€” when to exercise, whether to open windows, should children go to school â€” **with zero understanding of the air they're breathing.** Existing solutions fail them across every dimension:

| Gap | Reality |
|-----|---------|
| ğŸ“Š **Raw numbers, no context** | AQI 147 means nothing without health guidance |
| ğŸ‘¤ **Zero personalisation** | Same advice for a 7-year-old asthmatic and a healthy athlete |
| â³ **Stale data** | Batch-refreshed dashboards showing yesterday's air today |
| ğŸ™ï¸ **City-level only** | No drill-down to your neighbourhood station |
| ğŸ“‰ **No historical depth** | Can't compare today's air to the same day last year |
| ğŸ˜´ **No engagement** | People check once, forget, never build healthy habits |

</td>
<td width="42%">

```mermaid
pie title India AQI Awareness Gap
    "No awareness of tools" : 45
    "Generic dashboards only" : 30
    "Active daily monitors" : 15
    "Personalised insight" : 10
```

<br/>

<div align="center">

| Stat | Value |
|------|-------|
| Indians breathing unsafe air | **91%** (WHO) |
| Unaware of real-time AQI tools | **60%** |
| Receive personalised guidance | **< 5%** |
| Combined RT + history + gamification platforms | **0** |

</div>

</td>
</tr>
</table>

<br/>

<img src="https://capsule-render.vercel.app/api?type=rect&color=gradient&customColorList=0,2,4&height=3&section=header" />

<br/>

## ğŸ’¡ Solution

<div align="center">

### **Real-Time AQI Intelligence, Personalised for Every Breath**

*Live Stream Processing Â· Multi-Pollutant Tracking Â· Historical Analysis Â· City Rankings Â· Gamified Engagement Â· Embeddable Widgets Â· Auto-Generated SEO Blog*

<br/>

<table>
<tr>
<td align="center" width="20%">
  <img src="https://img.shields.io/badge/âš¡-Real--Time_Stream-6366F1?style=for-the-badge" />
  <br/><sub>60s live refresh via Pathway</sub>
</td>
<td align="center" width="20%">
  <img src="https://img.shields.io/badge/ğŸ‘¤-Personalised-10B981?style=for-the-badge" />
  <br/><sub>Health profiles per user</sub>
</td>
<td align="center" width="20%">
  <img src="https://img.shields.io/badge/ğŸ†-Gamified-F59E0B?style=for-the-badge" />
  <br/><sub>Streaks, badges & boards</sub>
</td>
<td align="center" width="20%">
  <img src="https://img.shields.io/badge/ğŸ—ºï¸-Live_Heatmap-EF4444?style=for-the-badge" />
  <br/><sub>45+ Indian cities</sub>
</td>
<td align="center" width="20%">
  <img src="https://img.shields.io/badge/ğŸ“Š-Historical-3B82F6?style=for-the-badge" />
  <br/><sub>Multi-year analysis</sub>
</td>
</tr>
</table>

**10 Powerful Features. 1 Unified Platform. Powered by Pathway.**

</div>

<br/>

<img src="https://capsule-render.vercel.app/api?type=rect&color=gradient&customColorList=0,2,4&height=3&section=header" />

<br/>

## âœ¨ Features

<details open>
<summary><h3>ğŸ  &nbsp;Live AQI Dashboard &nbsp;<img src="https://img.shields.io/badge/Real--time-60s_Updates-EF4444?style=flat-square" /></h3></summary>

<table>
<tr>
<td width="50%" valign="top">

The centrepiece of AQIfy â€” a live, streaming AQI dashboard that refreshes every 60 seconds via Pathway's stream processing engine and Socket.IO.

- ğŸ”´ Live AQI gauge with colour-coded health categories (Good â†’ Hazardous)
- ğŸ¥ Personalised health advisory card based on user profile
- ğŸ“ Per-station breakdown within your city
- ğŸŒ¤ï¸ Current weather: temperature, humidity, wind speed, UV index
- ğŸ“ˆ 24-hour AQI forecast chart (Open-Meteo CAMS model)
- ğŸ“… Year-over-year same-day comparative insight

</td>
<td width="50%" valign="top">

**Powered by:**

```
Socket.IO  â†’  live AQI_update events
Recharts   â†’  responsive forecast chart
Pathway    â†’  stream join + UDF classify
Zustand    â†’  global state management
```

<p>
<img src="https://img.shields.io/badge/Socket.IO-000000?style=flat-square&logo=socket.io&logoColor=white" />
<img src="https://img.shields.io/badge/Recharts-8884D8?style=flat-square" />
<img src="https://img.shields.io/badge/Pathway-6366F1?style=flat-square" />
<img src="https://img.shields.io/badge/Zustand-FF6B35?style=flat-square" />
</p>

</td>
</tr>
</table>

</details>

<details>
<summary><h3>ğŸ—ºï¸ &nbsp;India AQI Heatmap &nbsp;<img src="https://img.shields.io/badge/45%2B_Cities-Live-10B981?style=flat-square" /></h3></summary>

<table>
<tr>
<td width="50%" valign="top">

A live, interactive heatmap of India's air quality â€” 45+ cities rendered as colour-coded markers on a Leaflet.js map backed by CARTO tile layers.

- ğŸŸ¢ğŸŸ¡ğŸ”´ Colour-coded city markers (Good â†’ Hazardous)
- ğŸ–±ï¸ Click any city to drill down into stations
- ğŸ“ Sub-city station resolution
- ğŸ” AQI scale legend overlay
- ğŸ”„ Auto-refresh with live data from Pathway

</td>
<td width="50%" valign="top">

<p>
<img src="https://img.shields.io/badge/Leaflet.js-199900?style=flat-square&logo=leaflet&logoColor=white" />
<img src="https://img.shields.io/badge/CARTO_Tiles-990000?style=flat-square" />
<img src="https://img.shields.io/badge/WAQI_API-4285F4?style=flat-square" />
</p>

</td>
</tr>
</table>

</details>

<details>
<summary><h3>ğŸ”¬ &nbsp;Per-Pollutant Pages &nbsp;<img src="https://img.shields.io/badge/6_Pollutants-Tracked-F59E0B?style=flat-square" /></h3></summary>

Dedicated deep-dive pages for each of the 6 tracked pollutants with WHO/EPA threshold annotations.

| Pollutant | WHO Limit | Tracked Metrics |
|-----------|-----------|-----------------|
| **PM2.5** | 15 Âµg/mÂ³ | Last 120 readings, avg/max/min |
| **PM10** | 45 Âµg/mÂ³ | Last 120 readings, avg/max/min |
| **NOâ‚‚** | 10 Âµg/mÂ³ | Last 120 readings, avg/max/min |
| **Oâ‚ƒ** | 60 Âµg/mÂ³ | Last 120 readings, avg/max/min |
| **CO** | 4 mg/mÂ³ | Last 120 readings, avg/max/min |
| **SOâ‚‚** | 40 Âµg/mÂ³ | Last 120 readings, avg/max/min |

</details>

<details>
<summary><h3>ğŸ“… &nbsp;Historical AQI Analysis &nbsp;<img src="https://img.shields.io/badge/Multi--Year-2023_â†’_2026-3B82F6?style=flat-square" /></h3></summary>

<table>
<tr>
<td>

- ğŸ“† Year-over-year monthly comparison (2023â€“2026)
- ğŸŒ… 24-hour AQI pattern averaged over last 30 days
- ğŸ† Best hour / Worst hour statistics
- â˜€ï¸ Day average vs ğŸŒ™ Night average breakdown
- ğŸ“Š Hourly bar chart with AQI colour coding

**Powered by:**
<img src="https://img.shields.io/badge/PostgreSQL-316192?style=flat-square&logo=postgresql&logoColor=white" />
<img src="https://img.shields.io/badge/Pathway_Write-6366F1?style=flat-square" />
<img src="https://img.shields.io/badge/Recharts-8884D8?style=flat-square" />

</td>
</tr>
</table>

</details>

<details>
<summary><h3>ğŸ™ï¸ &nbsp;City Rankings &nbsp;<img src="https://img.shields.io/badge/Live-4_Sort_Modes-F59E0B?style=flat-square" /></h3></summary>

Live city rankings across 4 axes â€” refreshed every 5 minutes from WAQI + Open-Meteo dual streams joined in Pathway.

| Sort Mode | What It Shows |
|-----------|--------------|
| ğŸ”¥ **Hottest** | Cities ranked by temperature |
| ğŸ§Š **Coldest** | Cities ranked by lowest temperature |
| ğŸ’¨ **Most Polluted** | Cities ranked by AQI descending |
| âœ… **Cleanest** | Cities ranked by AQI ascending |

<img src="https://img.shields.io/badge/Open--Meteo-0EA5E9?style=flat-square" />
<img src="https://img.shields.io/badge/WAQI-4285F4?style=flat-square" />
<img src="https://img.shields.io/badge/Pathway_Join-6366F1?style=flat-square" />

</details>

<details>
<summary><h3>ğŸ§© &nbsp;Embeddable AQI Widget &nbsp;<img src="https://img.shields.io/badge/1--Line_Embed-10B981?style=flat-square" /></h3></summary>

Drop a live AQI card on any website with a single `<script>` tag.

```html
<script
  src="https://aqify.app/widget.js"
  data-city="indore"
  data-theme="light"
  data-lang="en"
></script>
```

- ğŸ™ï¸ City-configurable, auto-updating every 60 seconds
- ğŸ¨ Matches host site theme (`light` / `dark`)
- ğŸ“± Fully responsive for any screen size
- ğŸ”— Deep-links back to the full AQIfy dashboard

</details>

<details>
<summary><h3>ğŸŒ &nbsp;Multi-Language Support (i18n) &nbsp;<img src="https://img.shields.io/badge/Auto--Detect-Browser_Locale-8B5CF6?style=flat-square" /></h3></summary>

- Auto-detects browser locale on load
- ğŸ‡®ğŸ‡³ Hindi, Tamil, Telugu, Bengali + English
- Runtime language switching with zero page reload
- All health advisory text and AQI scale labels fully translated

<img src="https://img.shields.io/badge/i18next-26A69A?style=flat-square" />
<img src="https://img.shields.io/badge/react--i18next-61DAFB?style=flat-square" />

</details>

<details>
<summary><h3>ğŸ“ &nbsp;Auto-Generated SEO Blog &nbsp;<img src="https://img.shields.io/badge/Weekly_Auto--Posts-EF4444?style=flat-square" /></h3></summary>

- ğŸ¤– Weekly auto-generated city AQI reports via APScheduler
- ğŸ” SEO-optimised meta tags per page (react-helmet)
- ğŸ“° Markdown-rendered blog posts via react-markdown
- ğŸ“… APScheduler cron fires every Monday at 6AM
- ğŸŒ City-specific content auto-generated at scale

</details>

<br/>

<img src="https://capsule-render.vercel.app/api?type=rect&color=gradient&customColorList=0,2,4&height=3&section=header" />

<br/>

## ğŸ—ï¸ Architecture

<div align="center">

### **Pathway-Powered Real-Time Pipeline**

</div>

### System Overview

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                              DATA SOURCES                                    â•‘
â•‘                                                                              â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘   â”‚   WAQI API       â”‚    â”‚   Open-Meteo API      â”‚    â”‚  Browser GeoLoc  â”‚  â•‘
â•‘   â”‚  Real Govt AQI   â”‚    â”‚  Weather + Forecast   â”‚    â”‚  Community GPS   â”‚  â•‘
â•‘   â”‚  US 0â€“500 scale  â”‚    â”‚  Free Â· No API key    â”‚    â”‚  Reports         â”‚  â•‘
â•‘   â”‚  poll every 60s  â”‚    â”‚  poll every 300s      â”‚    â”‚                  â”‚  â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             â”‚                          â”‚
             â–¼                          â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                      PATHWAY AQI PIPELINE                                    â•‘
â•‘                  (pathway_aqi_pipeline.py)                                   â•‘
â•‘                                                                              â•‘
â•‘   WAQIStationConnectorSubject        OpenMeteoConnectorSubject               â•‘
â•‘   pw.io.python.read()                pw.io.python.read()                     â•‘
â•‘          â”‚                                    â”‚                              â•‘
â•‘          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â•‘
â•‘                         â–¼                                                    â•‘
â•‘                  station_table  â—„â”€â”€ LEFT JOIN â”€â”€â–º  weather_table            â•‘
â•‘                         â”‚              (on city_id)                          â•‘
â•‘                         â–¼                                                    â•‘
â•‘                   combined_table                                             â•‘
â•‘                    â”œâ”€â”€ classify_aqi()  @pw.udf  â†’ health_category            â•‘
â•‘                    â””â”€â”€ alert_filter()  @pw.udf  â†’ rows where aqi > threshold â•‘
â•‘                         â”‚                                                    â•‘
â•‘              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â•‘
â•‘              â–¼                     â–¼                                         â•‘
â•‘        Redis pub/sub         pg.write_snapshot                               â•‘
â•‘        (aqi:live)            aqi_history table                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             â”‚
             â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              FASTAPI SERVER  (api/main.py Â· port 8000)                       â•‘
â•‘     REST endpoints + python-socketio server + APScheduler blog cron          â•‘
â•‘     Subscribes Redis "aqi:live" â†’ broadcasts to all browser clients          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             â”‚
             â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              REACT 18 FRONTEND  (Vite Â· port 3000)                           â•‘
â•‘   Dashboard Â· Heatmap Â· Pollutants Â· History Â· Rankings Â· Leaderboard        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

<br/>

### Mermaid Architecture Graph

```mermaid
graph TB
    subgraph SRC["ğŸŒ  Data Sources"]
        W[WAQI API<br/>Real Govt AQI Â· 60s poll]
        OM[Open-Meteo API<br/>Weather + Forecast Â· 300s poll]
        GEO[Browser Geolocation<br/>Community Reports]
    end

    subgraph PW["âš¡  Pathway Pipeline"]
        WC[WAQIConnectorSubject<br/>pw.io.python.read]
        MC[OpenMeteoConnectorSubject<br/>pw.io.python.read]
        JOIN[LEFT JOIN on city_id]
        CLASSIFY["classify_aqi @pw.udf<br/>â†’ health_category"]
        ALERT["alert_filter @pw.udf<br/>â†’ aqi > threshold rows"]
    end

    subgraph IPC["ğŸ”€  IPC Layer"]
        REDIS[(Redis 7<br/>pub/sub Â· aqi:live)]
        PG[(PostgreSQL 15<br/>aqi_history Â· snapshots)]
    end

    subgraph API["ğŸ› ï¸  API Layer"]
        FASTAPI[FastAPI + python-socketio<br/>uvicorn Â· port 8000]
        SCHED[APScheduler<br/>Blog Cron Â· Mon 6AM]
    end

    subgraph FE["ğŸ–¥ï¸  Frontend  React 18 + Vite"]
        DASH[ğŸ  Dashboard]
        MAP[ğŸ—ºï¸ Heatmap]
        POLL[ğŸ”¬ Pollutants]
        HIST[ğŸ“… History]
        RANK[ğŸ™ï¸ Rankings]
        LEAD[ğŸ† Leaderboard]
        BLOG[ğŸ“ Blog]
    end

    W --> WC
    OM --> MC
    WC --> JOIN
    MC --> JOIN
    JOIN --> CLASSIFY
    CLASSIFY --> ALERT
    ALERT --> REDIS
    ALERT --> PG
    REDIS --> FASTAPI
    PG --> FASTAPI
    GEO --> FASTAPI
    SCHED --> BLOG
    FASTAPI -->|"Socket.IO  âš¡"| DASH
    FASTAPI -->|REST| MAP
    FASTAPI -->|REST| POLL
    FASTAPI -->|REST| HIST
    FASTAPI -->|REST| RANK
    FASTAPI -->|REST| LEAD
    FASTAPI --> SCHED

    style WC fill:#6366f1,stroke:#4338ca,color:#fff
    style MC fill:#6366f1,stroke:#4338ca,color:#fff
    style JOIN fill:#6366f1,stroke:#4338ca,color:#fff
    style CLASSIFY fill:#6366f1,stroke:#4338ca,color:#fff
    style ALERT fill:#6366f1,stroke:#4338ca,color:#fff
    style REDIS fill:#DC382D,stroke:#b91c1c,color:#fff
    style PG fill:#316192,stroke:#1e4070,color:#fff
    style FASTAPI fill:#009688,stroke:#00695c,color:#fff
    style SCHED fill:#3B82F6,stroke:#2563eb,color:#fff
```

<br/>

### C4 Container Diagram

```mermaid
C4Container
    title AQIfy â€” C4 Container Diagram

    Person(user, "User", "Views AQI, health advisories, leaderboard")
    Person(dev, "Developer", "Embeds AQI widget on external site")

    System_Boundary(aqify, "AQIfy Platform") {
        Container(frontend, "React 18 SPA", "Vite Â· TypeScript", "Dashboard, Heatmap, History, Rankings, Leaderboard, Blog")
        Container(api, "FastAPI Server", "Python Â· uvicorn", "REST API + Socket.IO + APScheduler")
        Container(pipeline, "Pathway Pipeline", "Python Â· Pathway 0.27.0", "Stream processing â€” WAQI join Open-Meteo, classify, persist")
        ContainerDb(postgres, "PostgreSQL 15", "Relational DB", "aqi_history, aqi_snapshot, city_registry, gamification")
        ContainerDb(redis, "Redis 7", "In-memory store", "pub/sub aqi:live channel, session cache")
    }

    System_Ext(waqi, "WAQI API", "Real govt station AQI data â€” US 0-500 scale")
    System_Ext(meteo, "Open-Meteo", "Free weather + 5-day AQI forecast, no key")
    System_Ext(supabase, "Supabase Auth", "JWT authentication + user profiles")

    Rel(user, frontend, "Uses", "HTTPS / WebSocket")
    Rel(dev, api, "Embeds widget", "HTTPS")
    Rel(frontend, api, "Calls REST & Socket.IO", "HTTPS / WSS")
    Rel(api, redis, "Subscribes aqi:live", "TCP")
    Rel(api, postgres, "Reads history & snapshots", "asyncpg")
    Rel(api, supabase, "Validates JWT", "HTTPS")
    Rel(pipeline, waqi, "Polls every 60s", "HTTPS")
    Rel(pipeline, meteo, "Polls every 300s", "HTTPS")
    Rel(pipeline, redis, "Publishes aqi:live", "TCP")
    Rel(pipeline, postgres, "write_snapshot", "psycopg2")
```

<br/>

### Live Data Sequence Diagram

```mermaid
sequenceDiagram
    participant WAQI as WAQI API
    participant PW as Pathway Pipeline
    participant REDIS as Redis pub/sub
    participant API as FastAPI Server
    participant WS as Socket.IO Client
    participant UI as React Dashboard

    loop Every 60 seconds
        PW->>WAQI: GET /feed/{city}/?token=...
        WAQI-->>PW: { aqi, pm25, pm10, ... }
    end

    PW->>PW: LEFT JOIN with weather_table on city_id
    PW->>PW: classify_aqi @pw.udf â†’ health_category
    PW->>PW: alert_filter @pw.udf â†’ filtered rows
    PW->>REDIS: PUBLISH aqi:live { city, aqi, health_cat, weather }
    PW->>+DB: write_snapshot â†’ aqi_history

    API->>REDIS: SUBSCRIBE aqi:live
    REDIS-->>API: Message received

    API->>WS: emit('aqi_update', payload)
    WS-->>UI: Socket event received
    UI->>UI: Update AQI gauge + health advisory
    UI->>UI: Re-render forecast chart
```

<br/>

### Authentication Flow

```mermaid
sequenceDiagram
    participant U as User Browser
    participant FE as React SPA
    participant SB as Supabase Auth
    participant API as FastAPI

    U->>FE: Click "Sign In"
    FE->>SB: signInWithEmail(email, password)
    SB-->>FE: { access_token (JWT), refresh_token }
    FE->>FE: Store tokens in memory (Zustand)

    U->>FE: Request leaderboard data
    FE->>API: GET /api/gamification/leaderboard<br/>Authorization: Bearer <JWT>
    API->>SB: Validate JWT signature
    SB-->>API: { user_id, email, city }
    API-->>FE: { leaderboard, user_rank, points }
    FE-->>U: Render leaderboard

    Note over FE,API: API keys (WAQI, IPinfo) never leave the server
```

<br/>

### Database ER Diagram

```mermaid
erDiagram
    CITY_REGISTRY {
        uuid city_id PK
        string slug
        string name
        float latitude
        float longitude
        string country
    }

    STATION {
        uuid station_id PK
        uuid city_id FK
        string station_name
        float lat
        float lon
        string source
    }

    AQI_SNAPSHOT {
        uuid id PK
        uuid city_id FK
        int aqi
        string health_category
        float temperature
        float humidity
        float wind_speed
        int uv_index
        timestamp updated_at
        int diff
        int time
    }

    AQI_HISTORY {
        bigserial id PK
        uuid city_id FK
        uuid station_id FK
        float pm25
        float pm10
        float no2
        float o3
        float co
        float so2
        int aqi
        timestamp recorded_at
        int time
        int diff
    }

    USER_PROFILE {
        uuid user_id PK
        string email
        string city_slug
        string health_profile
        string preferred_lang
        int total_points
        timestamp created_at
    }

    GAMIFICATION_EVENT {
        bigserial id PK
        uuid user_id FK
        string action_type
        int points_earned
        timestamp event_at
    }

    BADGE {
        uuid badge_id PK
        string name
        string icon
        string unlock_condition
    }

    USER_BADGE {
        uuid user_id FK
        uuid badge_id FK
        timestamp earned_at
    }

    BLOG_POST {
        uuid post_id PK
        uuid city_id FK
        string title
        string slug
        text content_md
        timestamp published_at
    }

    CITY_REGISTRY ||--o{ STATION : "has"
    CITY_REGISTRY ||--o{ AQI_SNAPSHOT : "has"
    CITY_REGISTRY ||--o{ AQI_HISTORY : "has"
    CITY_REGISTRY ||--o{ BLOG_POST : "about"
    STATION ||--o{ AQI_HISTORY : "records"
    USER_PROFILE ||--o{ GAMIFICATION_EVENT : "triggers"
    USER_PROFILE ||--o{ USER_BADGE : "earns"
    BADGE ||--o{ USER_BADGE : "awarded via"
```

<br/>

### CI/CD Pipeline

```mermaid
flowchart LR
    DEV([ğŸ‘¨â€ğŸ’» Developer]) -->|git push| GH[GitHub Repo]

    GH --> CI{GitHub Actions}

    CI --> LINT[ğŸ” Lint & Type Check<br/>eslint Â· mypy Â· ruff]
    CI --> TEST[ğŸ§ª Unit Tests<br/>pytest Â· vitest]
    CI --> BUILD[ğŸ—ï¸ Docker Build<br/>5 containers]

    LINT --> |pass| MERGE{PR Merged<br/>to main}
    TEST --> |pass| MERGE
    BUILD --> |pass| MERGE

    MERGE --> STAGING[ğŸŸ¡ Staging Deploy<br/>docker-compose pull + up]
    STAGING --> SMOKE[ğŸ’¨ Smoke Tests<br/>curl /health]
    SMOKE --> |pass| PROD[ğŸš€ Production Deploy<br/>Rolling restart]
    PROD --> NOTIFY[ğŸ“£ Notify Slack<br/>Deploy success]

    style DEV fill:#6366f1,color:#fff
    style PROD fill:#10B981,color:#fff
    style CI fill:#F59E0B,color:#fff
    style MERGE fill:#3B82F6,color:#fff
```

<br/>

### Deployment Diagram

```mermaid
graph TB
    subgraph HOST["ğŸ–¥ï¸  Docker Host  (Ubuntu 22.04)"]
        subgraph NET["aqify-network  (bridge)"]
            FE["ğŸ“¦  frontend<br/>nginx:alpine<br/>port 3000:80"]
            API["ğŸ“¦  api<br/>python:3.11-slim<br/>port 8000:8000"]
            PW["ğŸ“¦  pathway_aqi<br/>python:3.11-slim<br/>(internal only)"]
            PG["ğŸ“¦  postgres<br/>postgres:15-alpine<br/>port 5432:5432"]
            RD["ğŸ“¦  redis<br/>redis:7-alpine<br/>port 6379:6379"]
        end
        VOL1[("ğŸ“‚  pgdata<br/>Docker Volume")]
        VOL2[("ğŸ“‚  .env<br/>bind mount")]
    end

    NGINX["ğŸŒ  Nginx Reverse Proxy<br/>:443 â†’ :3000 / :8000"] --> FE
    NGINX --> API
    PG --- VOL1
    API --- VOL2
    PW --- VOL2
    PW -->|pub aqi:live| RD
    RD -->|sub aqi:live| API
    PW -->|write_snapshot| PG
    API -->|asyncpg queries| PG
    FE -->|Socket.IO + REST| API
```

<br/>

### Key Architectural Decisions

| Decision | Alternative Considered | Why AQIfy's Approach Wins |
|----------|----------------------|--------------------------|
| `ConnectorSubject` for ingestion | `pw.io.http.read` | `http.read` is a webhook listener, NOT an HTTP client. `ConnectorSubject` is the correct Pathway pattern for polling external REST APIs |
| Redis pub/sub (direct from Pathway) | File-based JSONL bridge | Pathway publishes to `aqi:live`; FastAPI subscribes â€” zero file I/O, sub-1s latency |
| Celery removed entirely | Celery + Redis | Pathway's `ConnectorSubject` handles all background polling in a persistent stateful loop |
| WAQI as primary AQI source | OpenWeatherMap | WAQI returns real US EPA 0â€“500 from government stations. OWM returns only a 1â€“5 ordinal index |
| Open-Meteo for weather | Paid weather API | Completely free, no API key, includes 5-day AQI forecast via CAMS European model |
| `@pw.udf` throughout | `pw.apply()` (deprecated) | Verified against official Pathway 0.27.0 API |

<br/>

<img src="https://capsule-render.vercel.app/api?type=rect&color=gradient&customColorList=0,2,4&height=3&section=header" />

<br/>

## ğŸ› ï¸ Tech Stack

<div align="center">

### **Production-Grade Â· Stream-Native Â· Containerised**

</div>

<table>
<tr>
<td width="50%" valign="top">

#### âš¡ Stream Processing
<img src="https://img.shields.io/badge/Pathway_0.27.0-Stream_Engine-6366F1?style=for-the-badge&logo=python&logoColor=white" />

- `pw.io.python.ConnectorSubject` â€” polls WAQI + Open-Meteo every N seconds
- `@pw.udf` decorator â€” classify AQI health categories, compute alert rows
- `pw.io.postgres.write_snapshot` â€” persistent ordered history with `time` + `diff`
- `pw.Table.join` â€” real-time dual-source stream merging

#### ğŸš€ API Server
<img src="https://img.shields.io/badge/FastAPI-009688?style=for-the-badge&logo=fastapi&logoColor=white" />
<img src="https://img.shields.io/badge/python--socketio-000000?style=for-the-badge" />
<img src="https://img.shields.io/badge/uvicorn-499848?style=for-the-badge" />

#### ğŸ—„ï¸ Data & IPC
<img src="https://img.shields.io/badge/PostgreSQL_15-316192?style=for-the-badge&logo=postgresql&logoColor=white" />
<img src="https://img.shields.io/badge/Redis_7-DC382D?style=for-the-badge&logo=redis&logoColor=white" />

- Redis pub/sub: `aqi:live` channel (Pathway â†’ FastAPI)
- PostgreSQL: `station_aqi_history`, `aqi_snapshot`, `city_registry`
- asyncpg + SQLAlchemy 2.0 for async queries
- Alembic for schema migrations

#### â° Scheduling
<img src="https://img.shields.io/badge/APScheduler-3B82F6?style=for-the-badge" />

- Monday 6AM cron â†’ auto-generates weekly city blog posts

</td>
<td width="50%" valign="top">

#### ğŸ–¥ï¸ Frontend Core
<img src="https://img.shields.io/badge/React_18-20232A?style=for-the-badge&logo=react&logoColor=61DAFB" />
<img src="https://img.shields.io/badge/TypeScript-3178C6?style=for-the-badge&logo=typescript&logoColor=white" />
<img src="https://img.shields.io/badge/Vite-646CFF?style=for-the-badge&logo=vite&logoColor=white" />

#### ğŸ“Š Data Visualisation
<img src="https://img.shields.io/badge/Recharts-8884D8?style=for-the-badge" />
<img src="https://img.shields.io/badge/Leaflet.js-199900?style=for-the-badge&logo=leaflet&logoColor=white" />

#### ğŸ”´ Real-Time
<img src="https://img.shields.io/badge/Socket.IO_Client-000000?style=for-the-badge&logo=socket.io&logoColor=white" />

#### ğŸŒ i18n
<img src="https://img.shields.io/badge/i18next-26A69A?style=for-the-badge" />
<img src="https://img.shields.io/badge/react--i18next-61DAFB?style=for-the-badge" />

#### ğŸ” Auth
<img src="https://img.shields.io/badge/Supabase-3ECF8E?style=for-the-badge&logo=supabase&logoColor=white" />

- JWT-based auth with refresh token rotation
- User profiles: city, health status, language preference

#### ğŸ³ Infrastructure
<img src="https://img.shields.io/badge/Docker_Compose-2496ED?style=for-the-badge&logo=docker&logoColor=white" />

- 5 containers: frontend Â· api Â· pathway_aqi Â· postgres Â· redis
- Total Docker image size: ~676 MB
- Frontend bundle: ~584 KB gzipped

</td>
</tr>
</table>

<br/>

<img src="https://capsule-render.vercel.app/api?type=rect&color=gradient&customColorList=0,2,4&height=3&section=header" />

<br/>

## ğŸ“‚ Project Structure

```
aqify/
â”‚
â”œâ”€â”€ ğŸ“ backend/
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ pipeline/                         # Pathway stream processing
â”‚   â”‚   â”œâ”€â”€ pathway_aqi_pipeline.py          # Main pipeline â€” join, UDFs, persist
â”‚   â”‚   â”œâ”€â”€ ğŸ“ connectors/
â”‚   â”‚   â”‚   â”œâ”€â”€ waqi_connector.py            # WAQIStationConnectorSubject
â”‚   â”‚   â”‚   â””â”€â”€ open_meteo_connector.py      # OpenMeteoConnectorSubject
â”‚   â”‚   â”œâ”€â”€ ğŸ“ udfs/
â”‚   â”‚   â”‚   â”œâ”€â”€ classify_aqi.py              # @pw.udf â€” AQI â†’ health_category
â”‚   â”‚   â”‚   â””â”€â”€ alert_filter.py              # @pw.udf â€” threshold row filter
â”‚   â”‚   â””â”€â”€ requirements_pipeline.txt
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ api/                              # FastAPI server
â”‚   â”‚   â”œâ”€â”€ main.py                          # FastAPI + python-socketio entrypoint
â”‚   â”‚   â”œâ”€â”€ ğŸ“ routes/
â”‚   â”‚   â”‚   â”œâ”€â”€ aqi.py                       # Live AQI REST endpoints
â”‚   â”‚   â”‚   â”œâ”€â”€ history.py                   # Historical analysis
â”‚   â”‚   â”‚   â”œâ”€â”€ rankings.py                  # City rankings (4 sort modes)
â”‚   â”‚   â”‚   â”œâ”€â”€ pollutants.py                # Per-pollutant pages
â”‚   â”‚   â”‚   â”œâ”€â”€ blog.py                      # Auto-generated blog
â”‚   â”‚   â”‚   â””â”€â”€ gamification.py              # Points, badges, leaderboard
â”‚   â”‚   â”œâ”€â”€ ğŸ“ bridges/
â”‚   â”‚   â”‚   â””â”€â”€ redis_bridge.py              # Redis aqi:live â†’ Socket.IO relay
â”‚   â”‚   â””â”€â”€ requirements_api.txt
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ data/
â”‚       â”œâ”€â”€ city_registry.py                 # 45+ city slug + lat/lon registry
â”‚       â”œâ”€â”€ city_seed.sql                    # Initial city data
â”‚       â”œâ”€â”€ station_seed.sql                 # Monitoring station seeding
â”‚       â””â”€â”€ seed_historical.py               # Backfill 3 years of AQI history
â”‚
â”œâ”€â”€ ğŸ“ frontend/
â”‚   â”œâ”€â”€ ğŸ“ src/
â”‚   â”‚   â”œâ”€â”€ ğŸ“ pages/
â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.tsx                # Live AQI dashboard
â”‚   â”‚   â”‚   â”œâ”€â”€ Heatmap.tsx                  # India AQI map (Leaflet)
â”‚   â”‚   â”‚   â”œâ”€â”€ Pollutants.tsx               # Per-pollutant charts
â”‚   â”‚   â”‚   â”œâ”€â”€ History.tsx                  # Year-over-year analysis
â”‚   â”‚   â”‚   â”œâ”€â”€ Rankings.tsx                 # City comparison table
â”‚   â”‚   â”‚   â”œâ”€â”€ Leaderboard.tsx              # Gamification board
â”‚   â”‚   â”‚   â””â”€â”€ Blog.tsx                     # Auto-generated posts
â”‚   â”‚   â”œâ”€â”€ ğŸ“ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ AQIGauge.tsx                 # Colour-coded AQI dial
â”‚   â”‚   â”‚   â”œâ”€â”€ HealthAdvisory.tsx           # Personalised advice card
â”‚   â”‚   â”‚   â”œâ”€â”€ StationCard.tsx              # Sub-city station widget
â”‚   â”‚   â”‚   â”œâ”€â”€ WeatherWidget.tsx            # Temp Â· humidity Â· wind Â· UV
â”‚   â”‚   â”‚   â”œâ”€â”€ YoYInsight.tsx               # Same-day YoY text insight
â”‚   â”‚   â”‚   â”œâ”€â”€ ForecastChart.tsx            # 24h forecast (Recharts)
â”‚   â”‚   â”‚   â””â”€â”€ EmbedWidget.tsx              # Embeddable snippet generator
â”‚   â”‚   â”œâ”€â”€ ğŸ“ i18n/
â”‚   â”‚   â”‚   â”œâ”€â”€ en.json                      # English strings
â”‚   â”‚   â”‚   â”œâ”€â”€ hi.json                      # Hindi strings
â”‚   â”‚   â”‚   â””â”€â”€ ta.json                      # Tamil strings
â”‚   â”‚   â”œâ”€â”€ ğŸ“ store/
â”‚   â”‚   â”‚   â””â”€â”€ useAQIStore.ts               # Zustand global state
â”‚   â”‚   â””â”€â”€ ğŸ“ hooks/
â”‚   â”‚       â”œâ”€â”€ useSocket.ts                 # Socket.IO live data hook
â”‚   â”‚       â””â”€â”€ useAQIHistory.ts             # Historical data fetching
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ docker-compose.yml                       # 5-container orchestration
â”œâ”€â”€ .env.example                             # Environment template
â””â”€â”€ README.md
```

<br/>

<img src="https://capsule-render.vercel.app/api?type=rect&color=gradient&customColorList=0,2,4&height=3&section=header" />

<br/>

## ğŸš€ Quick Start

### Prerequisites

<p align="center">
  <img src="https://img.shields.io/badge/Docker_Compose-â‰¥_2.x-2496ED?style=for-the-badge&logo=docker&logoColor=white" />
  <img src="https://img.shields.io/badge/Node.js-â‰¥_18.x-339933?style=for-the-badge&logo=node.js&logoColor=white" />
  <img src="https://img.shields.io/badge/Python-â‰¥_3.11-3776AB?style=for-the-badge&logo=python&logoColor=white" />
</p>

### API Keys

| Service | Required | Get It |
|---------|----------|--------|
| **WAQI Token** | âœ… Yes | [aqicn.org/data-platform/token](https://aqicn.org/data-platform/token/) |
| **IPinfo Token** | âœ… Yes | [ipinfo.io/account/token](https://ipinfo.io/account/token) |
| **Supabase URL + Key** | âœ… Yes | [supabase.com](https://supabase.com) |
| **Open-Meteo** | âŒ None needed | Free, no registration required |

### Installation

```bash
# 1ï¸âƒ£  Clone the repository
git clone https://github.com/yourusername/aqify.git
cd aqify

# 2ï¸âƒ£  Configure environment
cp .env.example .env
# Fill in: WAQI_TOKEN, IPINFO_TOKEN, SUPABASE_URL, SUPABASE_KEY
# DATABASE_URL and REDIS_URL are pre-configured for docker-compose

# 3ï¸âƒ£  Seed the database
psql $DATABASE_URL < backend/data/city_seed.sql
psql $DATABASE_URL < backend/data/station_seed.sql

# 4ï¸âƒ£  (Optional but recommended) Backfill 3 years of AQI history
python backend/data/seed_historical.py   # ~10 minutes

# 5ï¸âƒ£  Launch all 5 containers
docker-compose up --build
```

### Verify Services

```bash
# âœ…  Check Pathway pipeline is writing data
docker exec aqify_pathway_aqi cat /tmp/aqi_output.jsonl | head -5

# âœ…  Check Redis is receiving AQI updates
docker exec aqify_redis redis-cli subscribe aqi:live

# âœ…  Check FastAPI is live
curl http://localhost:8000/health

# âœ…  Open frontend
open http://localhost:3000
```

### Available Commands

| Command | Description |
|---------|-------------|
| `docker-compose up --build` | ğŸš€ Launch all 5 services from scratch |
| `docker-compose up pathway_aqi` | âš¡ Run Pathway pipeline only |
| `docker-compose logs -f api` | ğŸ“‹ Stream FastAPI logs in real time |
| `POST /blog/generate/weekly` | ğŸ“ Manually trigger blog generation |
| `python backend/data/seed_historical.py` | ğŸ“Š Backfill 3 years of AQI history |

<br/>

<img src="https://capsule-render.vercel.app/api?type=rect&color=gradient&customColorList=0,2,4&height=3&section=header" />

<br/>

## ğŸŒ API Reference

<details>
<summary><b>âš¡ Live AQI Endpoints</b></summary>

<br/>

```typescript
// Live AQI for a city (AQI + weather joined by Pathway)
GET /api/aqi/city/{city_id}

// All monitoring stations within a city (sub-city resolution)
GET /api/aqi/stations/{city_id}

// All 45+ cities with current AQI â€” used by the heatmap
GET /api/aqi/heatmap

// â”€â”€â”€ Socket.IO real-time events â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
socket.on('aqi_update',   (data: AQIUpdate)   => { /* live AQI */ })
socket.on('station_update', (data: StationUpdate) => { /* station */ })
```

</details>

<details>
<summary><b>ğŸ“… Historical Analysis Endpoints</b></summary>

<br/>

```typescript
// Year-over-year monthly comparison
GET /api/history/{city_id}/yoy?month=2&years=2023,2024,2025,2026

// 24-hour AQI pattern averaged over last N days
GET /api/history/{city_id}/24h-pattern?days=30

// "Today ranks Xth worst for this calendar day across 3 years"
GET /api/history/{city_id}/same-day-insight
```

</details>

<details>
<summary><b>ğŸ”¬ Pollutant Endpoints</b></summary>

<br/>

```typescript
// pollutant: pm25 | pm10 | no2 | o3 | co | so2
GET /api/pollutants/{city_id}/{pollutant}

Response: {
  readings:   [{ timestamp: string; value: number; unit: string }],  // last 120
  average:    number,
  maximum:    number,
  minimum:    number,
  safe_limit: number,   // WHO / EPA threshold
  unit:       string
}
```

</details>

<details>
<summary><b>ğŸ™ï¸ Rankings Endpoint</b></summary>

<br/>

```typescript
// sort: hottest | coldest | most_polluted | cleanest
GET /api/rankings?sort=most_polluted

Response: {
  cities: [{
    rank:        number,
    city:        string,
    country:     string,
    aqi:         number,
    temperature: number,
    humidity:    number,
    wind_speed:  number
  }],
  updated_at: string   // ISO timestamp of last Pathway write
}
```

</details>

<details>
<summary><b>ğŸ§© Embeddable Widget</b></summary>

<br/>

```html
<!-- Drop this anywhere to show a live AQI card for any supported city -->
<script
  src="https://aqify.app/widget.js"
  data-city="indore"
  data-theme="light"
  data-lang="en"
></script>
```

</details>

<br/>

<img src="https://capsule-render.vercel.app/api?type=rect&color=gradient&customColorList=0,2,4&height=3&section=header" />

<br/>

## ğŸ® AQI Scale Reference

<div align="center">

| Category | AQI Range | Health Implication | Hex |
|:--------:|:---------:|:------------------:|:---:|
| ğŸŸ¢ **Good** | 0 â€“ 50 | Air quality satisfactory, minimal risk | `#00E400` |
| ğŸŸ¡ **Moderate** | 51 â€“ 100 | Acceptable; may concern sensitive groups | `#FFFF00` |
| ğŸŸ  **Unhealthy for Sensitive Groups** | 101 â€“ 150 | Sensitive groups may experience effects | `#FF7E00` |
| ğŸ”´ **Unhealthy** | 151 â€“ 200 | Everyone may begin to feel health effects | `#FF0000` |
| ğŸŸ£ **Very Unhealthy** | 201 â€“ 300 | Health alert â€” serious effects for everyone | `#8F3F97` |
| ğŸŸ¤ **Hazardous** | 301+ | Emergency conditions; entire population at risk | `#7E0023` |

</div>

<br/>

<img src="https://capsule-render.vercel.app/api?type=rect&color=gradient&customColorList=0,2,4&height=3&section=header" />

<br/>

## ğŸ† Gamification

<div align="center">

### **Keep Users Breathing Mindfully â€” Every Day**

<img src="https://img.shields.io/badge/Daily_Streaks-ğŸ”¥-FF4500?style=for-the-badge" />
<img src="https://img.shields.io/badge/Health_Badges-ğŸ…-F59E0B?style=for-the-badge" />
<img src="https://img.shields.io/badge/City_Leaderboards-ğŸ†-10B981?style=for-the-badge" />
<img src="https://img.shields.io/badge/Points_System-â­-6366F1?style=for-the-badge" />

</div>

<br/>

<table>
<tr>
<td width="50%" valign="top">

#### â­ Points System

| Action | Points Earned |
|--------|:-------------:|
| Daily dashboard check-in | **+10** |
| Check AQI on an Unhealthy day | **+20** |
| 7-day streak maintained | **+50 bonus** |
| Share AQI alert with community | **+15** |
| Complete a daily health challenge | **+30** |
| First check-in of the month | **+25** |

</td>
<td width="50%" valign="top">

#### ğŸ… Badge Gallery

| Badge | Unlock Condition |
|:-----:|-----------------|
| ğŸŒ± **Air Aware** | First ever check-in |
| ğŸ”¥ **Week Warrior** | 7-day check-in streak |
| ğŸŒ **City Guardian** | Top 10 on local leaderboard |
| ğŸŒ¬ï¸ **Breath Expert** | 30-day check-in streak |
| ğŸ† **AQI Champion** | #1 on city leaderboard |
| ğŸ“Š **Data Nerd** | Viewed history 10+ times |

</td>
</tr>
</table>

<br/>

```mermaid
flowchart LR
    A([ğŸ‘¤ User opens app]) --> B{Daily check-in?}
    B -->|Yes| C[+10 points]
    B -->|No| Z([No reward])
    C --> D{AQI unhealthy?}
    D -->|Yes + checked| E[+20 bonus points]
    D -->|No| F[Standard points]
    E --> G{7-day streak?}
    F --> G
    G -->|Yes| H[+50 streak bonus ğŸ”¥]
    G -->|No| I[Streak counter +1]
    H --> J[Update leaderboard]
    I --> J
    J --> K{Top 10 locally?}
    K -->|Yes| L[ğŸŒ City Guardian badge]
    K -->|No| M([Continue streak])

    style A fill:#6366f1,color:#fff
    style H fill:#F59E0B,color:#fff
    style L fill:#10B981,color:#fff
```

<br/>

<img src="https://capsule-render.vercel.app/api?type=rect&color=gradient&customColorList=0,2,4&height=3&section=header" />

<br/>

## ğŸ”§ Pathway Implementation Notes

> For developers extending AQIfy â€” key Pathway API gotchas and verified patterns tested against v0.27.0.

| Pattern | âŒ Wrong | âœ… Correct |
|---------|---------|----------|
| Polling external APIs | `pw.io.http.read(url)` | `pw.io.python.ConnectorSubject` |
| PostgreSQL write | `pw.io.postgres.write(..., output_table_type="snapshot")` | `pw.io.postgres.write_snapshot(table, settings, name, ["col"])` |
| UDF definition | `pw.apply(fn, pw.this.col)` | `@pw.udf def fn(...) -> type:` then `fn(pw.this.col)` |
| Primary key in write | `primary_key=[table.city_id]` | `primary_key=["city_id"]` (list of strings) |
| History table schema | Missing `time` + `diff` columns | Must include `time INTEGER NOT NULL` + `diff SMALLINT NOT NULL` |
| Postgres connection | `connection_string=os.environ[...]` | `postgres_settings = {host, port, dbname, user, password}` dict |

<br/>

<img src="https://capsule-render.vercel.app/api?type=rect&color=gradient&customColorList=0,2,4&height=3&section=header" />

<br/>

## ğŸ“ˆ Performance Metrics

<div align="center">

| Metric | Value |
|:------:|:-----:|
| âš¡ AQI stream refresh rate | **60 seconds** (WAQI rate limit) |
| ğŸŒ¤ï¸ Weather refresh rate | **300 seconds** (Open-Meteo) |
| ğŸ™ï¸ Cities monitored | **45+ Indian cities** |
| ğŸ“¡ Stations tracked | **Sub-city resolution** per city |
| ğŸ“¦ Total Docker image size | **~676 MB** (5 containers) |
| ğŸ–¥ï¸ Frontend bundle size | **~584 KB** gzipped |
| â±ï¸ End-to-end stream latency | **< 1 second** (Pathway â†’ Redis â†’ Socket.IO â†’ Browser) |

</div>

<br/>

<img src="https://capsule-render.vercel.app/api?type=rect&color=gradient&customColorList=0,2,4&height=3&section=header" />

<br/>

## ğŸ—ºï¸ Roadmap

```mermaid
gantt
    title AQIfy Development Roadmap
    dateFormat  YYYY-MM-DD
    section ğŸ—ï¸ Phase 1 â€” Core
    Pathway Pipeline + Dual Source         :done,   p1a, 2024-01-01, 30d
    FastAPI + Socket.IO Bridge             :done,   p1b, 2024-01-15, 20d
    React Dashboard + Heatmap              :done,   p1c, 2024-02-01, 30d

    section ğŸ“Š Phase 2 â€” Depth
    Historical Analysis                    :done,   p2a, 2024-03-01, 20d
    Per-Pollutant Pages                    :done,   p2b, 2024-03-10, 15d
    City Rankings                          :done,   p2c, 2024-03-20, 10d

    section ğŸ† Phase 3 â€” Reach
    Gamification + Leaderboard             :done,   p3a, 2024-04-01, 20d
    Embeddable Widget                      :done,   p3b, 2024-04-10, 10d
    i18n + Auto-Generated Blog             :done,   p3c, 2024-04-15, 15d

    section ğŸš€ Phase 4 â€” Scale
    Mobile App (React Native)              :active, p4a, 2024-07-01, 90d
    IoT Sensor Integration                 :        p4b, 2024-09-01, 60d
    ML-based AQI Forecasting               :        p4c, 2024-10-01, 90d
    Hyperlocal Sub-city Resolution         :        p4d, 2025-01-01, 120d
```

<br/>

<img src="https://capsule-render.vercel.app/api?type=rect&color=gradient&customColorList=0,2,4&height=3&section=header" />

<br/>

## ğŸ”’ Security & Privacy

| Layer | Implementation |
|-------|---------------|
| ğŸ” **Authentication** | Supabase Auth â€” secure JWT with refresh token rotation |
| ğŸ›¡ï¸ **Privacy** | No PII stored; only city-level location, no precise GPS retained |
| ğŸ”‘ **API Key Safety** | WAQI + IPinfo tokens server-side only â€” never exposed to the browser |
| ğŸ“ **Rate Limiting** | FastAPI middleware prevents API abuse on all endpoints |
| ğŸ³ **Container Isolation** | Each service in its own Docker network segment |

<br/>

<img src="https://capsule-render.vercel.app/api?type=rect&color=gradient&customColorList=0,2,4&height=3&section=header" />

<br/>

## â“ FAQ

<details>
<summary><b>Q: Why Pathway instead of Celery or a simple cron job?</b></summary>
<br/>
Pathway provides a true stream processing engine â€” data flows as events, joins happen on live tables, and the pipeline is stateful. Celery would require manual state management, doesn't support stream joins, and adds unnecessary complexity. Pathway gives us real-time semantics with minimal code.
</details>

<details>
<summary><b>Q: Why WAQI over OpenWeatherMap for AQI data?</b></summary>
<br/>
OpenWeatherMap returns a 1â€“5 ordinal AQI index that requires manual conversion and loses precision. WAQI returns the real US EPA 0â€“500 scale directly from government monitoring stations â€” the same data used by official health agencies.
</details>

<details>
<summary><b>Q: Is Open-Meteo truly free with no API key?</b></summary>
<br/>
Yes â€” Open-Meteo is completely free with no API key required for non-commercial use. It provides hourly weather data, UV index, and 5-day AQI forecasts via the CAMS European air quality model.
</details>

<details>
<summary><b>Q: How does the Year-over-Year insight work?</b></summary>
<br/>
The Pathway pipeline writes every AQI reading to PostgreSQL with timestamps. The YoY endpoint queries the same calendar date across 2023, 2024, 2025, and 2026 and generates a natural-language ranking: <em>"Today's AQI of 35 ranks 3rd worst for this day across 3 years."</em>
</details>

<details>
<summary><b>Q: Can I embed AQIfy data on my own website?</b></summary>
<br/>
Yes! Use the embeddable widget â€” a single <code>&lt;script&gt;</code> tag that renders a live AQI card for any supported city. It auto-updates every 60 seconds and is fully responsive.
</details>

<details>
<summary><b>Q: How do I add a new city to the registry?</b></summary>
<br/>
Add an entry to <code>backend/data/city_registry.py</code> with the city slug, WAQI station ID, and lat/lon coordinates. Then re-run <code>city_seed.sql</code>. The Pathway pipeline will begin polling it automatically on next restart.
</details>

<br/>

<img src="https://capsule-render.vercel.app/api?type=rect&color=gradient&customColorList=0,2,4&height=3&section=header" />




<br/>

<img src="https://capsule-render.vercel.app/api?type=rect&color=gradient&customColorList=0,2,4&height=3&section=header" />

<br/>




<br/>

<img src="https://capsule-render.vercel.app/api?type=waving&color=0:24243e,50:302b63,100:0f0c29&height=180&section=footer&text=AQIfy&fontSize=60&fontAlignY=65&animation=fadeIn&fontColor=a5b4fc" />

<div align="center">

<br/>

<img src="https://img.shields.io/badge/Powered_by-Pathway_0.27.0-6366F1?style=for-the-badge&logo=python&logoColor=white" />
<img src="https://img.shields.io/badge/Built_with-React_18-61DAFB?style=for-the-badge&logo=react&logoColor=black" />
<img src="https://img.shields.io/badge/Monitoring-45%2B_Indian_Cities-FF9933?style=for-the-badge" />

<br/><br/>

### â­ Star this repo if AQIfy helped you breathe more mindfully!

<br/>

**AQIfy** â€” *Real-Time AQI Intelligence Engine* ğŸŒ«ï¸

*Made with â¤ï¸ and clean(ish) air*

</div>
